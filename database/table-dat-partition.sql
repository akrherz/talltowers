-- make children table
CREATE TABLE dat_y2016m03 ( CHECK ( ts >= DATE '2016-03-01' AND ts < DATE '2016-04-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2016m04 ( CHECK ( ts >= DATE '2016-04-01' AND ts < DATE '2016-05-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2016m05 ( CHECK ( ts >= DATE '2016-05-01' AND ts < DATE '2016-06-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2016m06 ( CHECK ( ts >= DATE '2016-06-01' AND ts < DATE '2016-07-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2016m07 ( CHECK ( ts >= DATE '2016-07-01' AND ts < DATE '2016-08-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2016m08 ( CHECK ( ts >= DATE '2016-08-01' AND ts < DATE '2016-09-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2016m09 ( CHECK ( ts >= DATE '2016-09-01' AND ts < DATE '2016-10-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2016m10 ( CHECK ( ts >= DATE '2016-10-01' AND ts < DATE '2016-11-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2016m11 ( CHECK ( ts >= DATE '2016-11-01' AND ts < DATE '2016-12-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2016m12 ( CHECK ( ts >= DATE '2016-12-01' AND ts < DATE '2017-01-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2017m01 ( CHECK ( ts >= DATE '2017-01-01' AND ts < DATE '2017-02-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2017m02 ( CHECK ( ts >= DATE '2017-02-01' AND ts < DATE '2017-03-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2017m03 ( CHECK ( ts >= DATE '2017-03-01' AND ts < DATE '2017-04-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2017m04 ( CHECK ( ts >= DATE '2017-04-01' AND ts < DATE '2017-05-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2017m05 ( CHECK ( ts >= DATE '2017-05-01' AND ts < DATE '2017-06-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2017m06 ( CHECK ( ts >= DATE '2017-06-01' AND ts < DATE '2017-07-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2017m07 ( CHECK ( ts >= DATE '2017-07-01' AND ts < DATE '2017-08-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2017m08 ( CHECK ( ts >= DATE '2017-08-01' AND ts < DATE '2017-09-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2017m09 ( CHECK ( ts >= DATE '2017-09-01' AND ts < DATE '2017-10-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2017m10 ( CHECK ( ts >= DATE '2017-10-01' AND ts < DATE '2017-11-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2017m11 ( CHECK ( ts >= DATE '2017-11-01' AND ts < DATE '2017-12-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2017m12 ( CHECK ( ts >= DATE '2017-12-01' AND ts < DATE '2018-01-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2018m01 ( CHECK ( ts >= DATE '2018-01-01' AND ts < DATE '2018-02-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2018m02 ( CHECK ( ts >= DATE '2018-02-01' AND ts < DATE '2018-03-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2018m03 ( CHECK ( ts >= DATE '2018-03-01' AND ts < DATE '2018-04-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2018m04 ( CHECK ( ts >= DATE '2018-04-01' AND ts < DATE '2018-05-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2018m05 ( CHECK ( ts >= DATE '2018-05-01' AND ts < DATE '2018-06-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2018m06 ( CHECK ( ts >= DATE '2018-06-01' AND ts < DATE '2018-07-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2018m07 ( CHECK ( ts >= DATE '2018-07-01' AND ts < DATE '2018-08-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2018m08 ( CHECK ( ts >= DATE '2018-08-01' AND ts < DATE '2018-09-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2018m09 ( CHECK ( ts >= DATE '2018-09-01' AND ts < DATE '2018-10-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2018m10 ( CHECK ( ts >= DATE '2018-10-01' AND ts < DATE '2018-11-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2018m11 ( CHECK ( ts >= DATE '2018-11-01' AND ts < DATE '2018-12-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2018m12 ( CHECK ( ts >= DATE '2018-12-01' AND ts < DATE '2019-01-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2019m01 ( CHECK ( ts >= DATE '2019-01-01' AND ts < DATE '2019-02-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2019m02 ( CHECK ( ts >= DATE '2019-02-01' AND ts < DATE '2019-03-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2019m03 ( CHECK ( ts >= DATE '2019-03-01' AND ts < DATE '2019-04-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2019m04 ( CHECK ( ts >= DATE '2019-04-01' AND ts < DATE '2019-05-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2019m05 ( CHECK ( ts >= DATE '2019-05-01' AND ts < DATE '2019-06-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2019m06 ( CHECK ( ts >= DATE '2019-06-01' AND ts < DATE '2019-07-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2019m07 ( CHECK ( ts >= DATE '2019-07-01' AND ts < DATE '2019-08-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2019m08 ( CHECK ( ts >= DATE '2019-08-01' AND ts < DATE '2019-09-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2019m09 ( CHECK ( ts >= DATE '2019-09-01' AND ts < DATE '2019-10-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2019m10 ( CHECK ( ts >= DATE '2019-10-01' AND ts < DATE '2019-11-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2019m11 ( CHECK ( ts >= DATE '2019-11-01' AND ts < DATE '2019-12-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2019m12 ( CHECK ( ts >= DATE '2019-12-01' AND ts < DATE '2020-01-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2020m01 ( CHECK ( ts >= DATE '2020-01-01' AND ts < DATE '2020-02-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2020m02 ( CHECK ( ts >= DATE '2020-02-01' AND ts < DATE '2020-03-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2020m03 ( CHECK ( ts >= DATE '2020-03-01' AND ts < DATE '2020-04-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2020m04 ( CHECK ( ts >= DATE '2020-04-01' AND ts < DATE '2020-05-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2020m05 ( CHECK ( ts >= DATE '2020-05-01' AND ts < DATE '2020-06-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2020m06 ( CHECK ( ts >= DATE '2020-06-01' AND ts < DATE '2020-07-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2020m07 ( CHECK ( ts >= DATE '2020-07-01' AND ts < DATE '2020-08-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2020m08 ( CHECK ( ts >= DATE '2020-08-01' AND ts < DATE '2020-09-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2020m09 ( CHECK ( ts >= DATE '2020-09-01' AND ts < DATE '2020-10-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2020m10 ( CHECK ( ts >= DATE '2020-10-01' AND ts < DATE '2020-11-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2020m11 ( CHECK ( ts >= DATE '2020-11-01' AND ts < DATE '2020-12-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2020m12 ( CHECK ( ts >= DATE '2020-12-01' AND ts < DATE '2021-01-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2021m01 ( CHECK ( ts >= DATE '2021-01-01' AND ts < DATE '2021-02-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2021m02 ( CHECK ( ts >= DATE '2021-02-01' AND ts < DATE '2021-03-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2021m03 ( CHECK ( ts >= DATE '2021-03-01' AND ts < DATE '2021-04-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2021m04 ( CHECK ( ts >= DATE '2021-04-01' AND ts < DATE '2021-05-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2021m05 ( CHECK ( ts >= DATE '2021-05-01' AND ts < DATE '2021-06-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2021m06 ( CHECK ( ts >= DATE '2021-06-01' AND ts < DATE '2021-07-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2021m07 ( CHECK ( ts >= DATE '2021-07-01' AND ts < DATE '2021-08-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2021m08 ( CHECK ( ts >= DATE '2021-08-01' AND ts < DATE '2021-09-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2021m09 ( CHECK ( ts >= DATE '2021-09-01' AND ts < DATE '2021-10-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2021m10 ( CHECK ( ts >= DATE '2021-10-01' AND ts < DATE '2021-11-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2021m11 ( CHECK ( ts >= DATE '2021-11-01' AND ts < DATE '2021-12-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2021m12 ( CHECK ( ts >= DATE '2021-12-01' AND ts < DATE '2022-01-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2022m01 ( CHECK ( ts >= DATE '2022-01-01' AND ts < DATE '2022-02-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2022m02 ( CHECK ( ts >= DATE '2022-02-01' AND ts < DATE '2022-03-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2022m03 ( CHECK ( ts >= DATE '2022-03-01' AND ts < DATE '2022-04-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2022m04 ( CHECK ( ts >= DATE '2022-04-01' AND ts < DATE '2022-05-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2022m05 ( CHECK ( ts >= DATE '2022-05-01' AND ts < DATE '2022-06-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2022m06 ( CHECK ( ts >= DATE '2022-06-01' AND ts < DATE '2022-07-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2022m07 ( CHECK ( ts >= DATE '2022-07-01' AND ts < DATE '2022-08-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2022m08 ( CHECK ( ts >= DATE '2022-08-01' AND ts < DATE '2022-09-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2022m09 ( CHECK ( ts >= DATE '2022-09-01' AND ts < DATE '2022-10-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2022m10 ( CHECK ( ts >= DATE '2022-10-01' AND ts < DATE '2022-11-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2022m11 ( CHECK ( ts >= DATE '2022-11-01' AND ts < DATE '2022-12-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2022m12 ( CHECK ( ts >= DATE '2022-12-01' AND ts < DATE '2023-01-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2023m01 ( CHECK ( ts >= DATE '2023-01-01' AND ts < DATE '2023-02-01' ) ) INHERITS (dat);
CREATE TABLE dat_y2023m02 ( CHECK ( ts >= DATE '2023-02-01' AND ts < DATE '2023-03-01' ) ) INHERITS (dat);


-- alter ownership
ALTER TABLE dat_y2016m03 OWNER TO tt_admin;
ALTER TABLE dat_y2016m04 OWNER TO tt_admin;
ALTER TABLE dat_y2016m05 OWNER TO tt_admin;
ALTER TABLE dat_y2016m06 OWNER TO tt_admin;
ALTER TABLE dat_y2016m07 OWNER TO tt_admin;
ALTER TABLE dat_y2016m08 OWNER TO tt_admin;
ALTER TABLE dat_y2016m09 OWNER TO tt_admin;
ALTER TABLE dat_y2016m10 OWNER TO tt_admin;
ALTER TABLE dat_y2016m11 OWNER TO tt_admin;
ALTER TABLE dat_y2016m12 OWNER TO tt_admin;
ALTER TABLE dat_y2017m01 OWNER TO tt_admin;
ALTER TABLE dat_y2017m02 OWNER TO tt_admin;
ALTER TABLE dat_y2017m03 OWNER TO tt_admin;
ALTER TABLE dat_y2017m04 OWNER TO tt_admin;
ALTER TABLE dat_y2017m05 OWNER TO tt_admin;
ALTER TABLE dat_y2017m06 OWNER TO tt_admin;
ALTER TABLE dat_y2017m07 OWNER TO tt_admin;
ALTER TABLE dat_y2017m08 OWNER TO tt_admin;
ALTER TABLE dat_y2017m09 OWNER TO tt_admin;
ALTER TABLE dat_y2017m10 OWNER TO tt_admin;
ALTER TABLE dat_y2017m11 OWNER TO tt_admin;
ALTER TABLE dat_y2017m12 OWNER TO tt_admin;
ALTER TABLE dat_y2018m01 OWNER TO tt_admin;
ALTER TABLE dat_y2018m02 OWNER TO tt_admin;
ALTER TABLE dat_y2018m03 OWNER TO tt_admin;
ALTER TABLE dat_y2018m04 OWNER TO tt_admin;
ALTER TABLE dat_y2018m05 OWNER TO tt_admin;
ALTER TABLE dat_y2018m06 OWNER TO tt_admin;
ALTER TABLE dat_y2018m07 OWNER TO tt_admin;
ALTER TABLE dat_y2018m08 OWNER TO tt_admin;
ALTER TABLE dat_y2018m09 OWNER TO tt_admin;
ALTER TABLE dat_y2018m10 OWNER TO tt_admin;
ALTER TABLE dat_y2018m11 OWNER TO tt_admin;
ALTER TABLE dat_y2018m12 OWNER TO tt_admin;
ALTER TABLE dat_y2019m01 OWNER TO tt_admin;
ALTER TABLE dat_y2019m02 OWNER TO tt_admin;
ALTER TABLE dat_y2019m03 OWNER TO tt_admin;
ALTER TABLE dat_y2019m04 OWNER TO tt_admin;
ALTER TABLE dat_y2019m05 OWNER TO tt_admin;
ALTER TABLE dat_y2019m06 OWNER TO tt_admin;
ALTER TABLE dat_y2019m07 OWNER TO tt_admin;
ALTER TABLE dat_y2019m08 OWNER TO tt_admin;
ALTER TABLE dat_y2019m09 OWNER TO tt_admin;
ALTER TABLE dat_y2019m10 OWNER TO tt_admin;
ALTER TABLE dat_y2019m11 OWNER TO tt_admin;
ALTER TABLE dat_y2019m12 OWNER TO tt_admin;
ALTER TABLE dat_y2020m01 OWNER TO tt_admin;
ALTER TABLE dat_y2020m02 OWNER TO tt_admin;
ALTER TABLE dat_y2020m03 OWNER TO tt_admin;
ALTER TABLE dat_y2020m04 OWNER TO tt_admin;
ALTER TABLE dat_y2020m05 OWNER TO tt_admin;
ALTER TABLE dat_y2020m06 OWNER TO tt_admin;
ALTER TABLE dat_y2020m07 OWNER TO tt_admin;
ALTER TABLE dat_y2020m08 OWNER TO tt_admin;
ALTER TABLE dat_y2020m09 OWNER TO tt_admin;
ALTER TABLE dat_y2020m10 OWNER TO tt_admin;
ALTER TABLE dat_y2020m11 OWNER TO tt_admin;
ALTER TABLE dat_y2020m12 OWNER TO tt_admin;
ALTER TABLE dat_y2021m01 OWNER TO tt_admin;
ALTER TABLE dat_y2021m02 OWNER TO tt_admin;
ALTER TABLE dat_y2021m03 OWNER TO tt_admin;
ALTER TABLE dat_y2021m04 OWNER TO tt_admin;
ALTER TABLE dat_y2021m05 OWNER TO tt_admin;
ALTER TABLE dat_y2021m06 OWNER TO tt_admin;
ALTER TABLE dat_y2021m07 OWNER TO tt_admin;
ALTER TABLE dat_y2021m08 OWNER TO tt_admin;
ALTER TABLE dat_y2021m09 OWNER TO tt_admin;
ALTER TABLE dat_y2021m10 OWNER TO tt_admin;
ALTER TABLE dat_y2021m11 OWNER TO tt_admin;
ALTER TABLE dat_y2021m12 OWNER TO tt_admin;
ALTER TABLE dat_y2022m01 OWNER TO tt_admin;
ALTER TABLE dat_y2022m02 OWNER TO tt_admin;
ALTER TABLE dat_y2022m03 OWNER TO tt_admin;
ALTER TABLE dat_y2022m04 OWNER TO tt_admin;
ALTER TABLE dat_y2022m05 OWNER TO tt_admin;
ALTER TABLE dat_y2022m06 OWNER TO tt_admin;
ALTER TABLE dat_y2022m07 OWNER TO tt_admin;
ALTER TABLE dat_y2022m08 OWNER TO tt_admin;
ALTER TABLE dat_y2022m09 OWNER TO tt_admin;
ALTER TABLE dat_y2022m10 OWNER TO tt_admin;
ALTER TABLE dat_y2022m11 OWNER TO tt_admin;
ALTER TABLE dat_y2022m12 OWNER TO tt_admin;
ALTER TABLE dat_y2023m01 OWNER TO tt_admin;
ALTER TABLE dat_y2023m02 OWNER TO tt_admin;


-- GRANT permission to child tables
GRANT INSERT ON TABLE dat_y2016m03 TO tt_script;
GRANT INSERT ON TABLE dat_y2016m04 TO tt_script;
GRANT INSERT ON TABLE dat_y2016m05 TO tt_script;
GRANT INSERT ON TABLE dat_y2016m06 TO tt_script;
GRANT INSERT ON TABLE dat_y2016m07 TO tt_script;
GRANT INSERT ON TABLE dat_y2016m08 TO tt_script;
GRANT INSERT ON TABLE dat_y2016m09 TO tt_script;
GRANT INSERT ON TABLE dat_y2016m10 TO tt_script;
GRANT INSERT ON TABLE dat_y2016m11 TO tt_script;
GRANT INSERT ON TABLE dat_y2016m12 TO tt_script;
GRANT INSERT ON TABLE dat_y2017m01 TO tt_script;
GRANT INSERT ON TABLE dat_y2017m02 TO tt_script;
GRANT INSERT ON TABLE dat_y2017m03 TO tt_script;
GRANT INSERT ON TABLE dat_y2017m04 TO tt_script;
GRANT INSERT ON TABLE dat_y2017m05 TO tt_script;
GRANT INSERT ON TABLE dat_y2017m06 TO tt_script;
GRANT INSERT ON TABLE dat_y2017m07 TO tt_script;
GRANT INSERT ON TABLE dat_y2017m08 TO tt_script;
GRANT INSERT ON TABLE dat_y2017m09 TO tt_script;
GRANT INSERT ON TABLE dat_y2017m10 TO tt_script;
GRANT INSERT ON TABLE dat_y2017m11 TO tt_script;
GRANT INSERT ON TABLE dat_y2017m12 TO tt_script;
GRANT INSERT ON TABLE dat_y2018m01 TO tt_script;
GRANT INSERT ON TABLE dat_y2018m02 TO tt_script;
GRANT INSERT ON TABLE dat_y2018m03 TO tt_script;
GRANT INSERT ON TABLE dat_y2018m04 TO tt_script;
GRANT INSERT ON TABLE dat_y2018m05 TO tt_script;
GRANT INSERT ON TABLE dat_y2018m06 TO tt_script;
GRANT INSERT ON TABLE dat_y2018m07 TO tt_script;
GRANT INSERT ON TABLE dat_y2018m08 TO tt_script;
GRANT INSERT ON TABLE dat_y2018m09 TO tt_script;
GRANT INSERT ON TABLE dat_y2018m10 TO tt_script;
GRANT INSERT ON TABLE dat_y2018m11 TO tt_script;
GRANT INSERT ON TABLE dat_y2018m12 TO tt_script;
GRANT INSERT ON TABLE dat_y2019m01 TO tt_script;
GRANT INSERT ON TABLE dat_y2019m02 TO tt_script;
GRANT INSERT ON TABLE dat_y2019m03 TO tt_script;
GRANT INSERT ON TABLE dat_y2019m04 TO tt_script;
GRANT INSERT ON TABLE dat_y2019m05 TO tt_script;
GRANT INSERT ON TABLE dat_y2019m06 TO tt_script;
GRANT INSERT ON TABLE dat_y2019m07 TO tt_script;
GRANT INSERT ON TABLE dat_y2019m08 TO tt_script;
GRANT INSERT ON TABLE dat_y2019m09 TO tt_script;
GRANT INSERT ON TABLE dat_y2019m10 TO tt_script;
GRANT INSERT ON TABLE dat_y2019m11 TO tt_script;
GRANT INSERT ON TABLE dat_y2019m12 TO tt_script;
GRANT INSERT ON TABLE dat_y2020m01 TO tt_script;
GRANT INSERT ON TABLE dat_y2020m02 TO tt_script;
GRANT INSERT ON TABLE dat_y2020m03 TO tt_script;
GRANT INSERT ON TABLE dat_y2020m04 TO tt_script;
GRANT INSERT ON TABLE dat_y2020m05 TO tt_script;
GRANT INSERT ON TABLE dat_y2020m06 TO tt_script;
GRANT INSERT ON TABLE dat_y2020m07 TO tt_script;
GRANT INSERT ON TABLE dat_y2020m08 TO tt_script;
GRANT INSERT ON TABLE dat_y2020m09 TO tt_script;
GRANT INSERT ON TABLE dat_y2020m10 TO tt_script;
GRANT INSERT ON TABLE dat_y2020m11 TO tt_script;
GRANT INSERT ON TABLE dat_y2020m12 TO tt_script;
GRANT INSERT ON TABLE dat_y2021m01 TO tt_script;
GRANT INSERT ON TABLE dat_y2021m02 TO tt_script;
GRANT INSERT ON TABLE dat_y2021m03 TO tt_script;
GRANT INSERT ON TABLE dat_y2021m04 TO tt_script;
GRANT INSERT ON TABLE dat_y2021m05 TO tt_script;
GRANT INSERT ON TABLE dat_y2021m06 TO tt_script;
GRANT INSERT ON TABLE dat_y2021m07 TO tt_script;
GRANT INSERT ON TABLE dat_y2021m08 TO tt_script;
GRANT INSERT ON TABLE dat_y2021m09 TO tt_script;
GRANT INSERT ON TABLE dat_y2021m10 TO tt_script;
GRANT INSERT ON TABLE dat_y2021m11 TO tt_script;
GRANT INSERT ON TABLE dat_y2021m12 TO tt_script;
GRANT INSERT ON TABLE dat_y2022m01 TO tt_script;
GRANT INSERT ON TABLE dat_y2022m02 TO tt_script;
GRANT INSERT ON TABLE dat_y2022m03 TO tt_script;
GRANT INSERT ON TABLE dat_y2022m04 TO tt_script;
GRANT INSERT ON TABLE dat_y2022m05 TO tt_script;
GRANT INSERT ON TABLE dat_y2022m06 TO tt_script;
GRANT INSERT ON TABLE dat_y2022m07 TO tt_script;
GRANT INSERT ON TABLE dat_y2022m08 TO tt_script;
GRANT INSERT ON TABLE dat_y2022m09 TO tt_script;
GRANT INSERT ON TABLE dat_y2022m10 TO tt_script;
GRANT INSERT ON TABLE dat_y2022m11 TO tt_script;
GRANT INSERT ON TABLE dat_y2022m12 TO tt_script;
GRANT INSERT ON TABLE dat_y2023m01 TO tt_script;
GRANT INSERT ON TABLE dat_y2023m02 TO tt_script;


-- make trigger function
CREATE OR REPLACE FUNCTION dat_insert_trigger()
RETURNS TRIGGER AS $$
BEGIN
  IF ( NEW.ts >= DATE '2016-03-01' AND NEW.ts < DATE '2016-04-01' ) THEN
    INSERT INTO dat_y2016m03 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2016-04-01' AND NEW.ts < DATE '2016-05-01' ) THEN
    INSERT INTO dat_y2016m04 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2016-05-01' AND NEW.ts < DATE '2016-06-01' ) THEN
    INSERT INTO dat_y2016m05 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2016-06-01' AND NEW.ts < DATE '2016-07-01' ) THEN
    INSERT INTO dat_y2016m06 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2016-07-01' AND NEW.ts < DATE '2016-08-01' ) THEN
    INSERT INTO dat_y2016m07 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2016-08-01' AND NEW.ts < DATE '2016-09-01' ) THEN
    INSERT INTO dat_y2016m08 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2016-09-01' AND NEW.ts < DATE '2016-10-01' ) THEN
    INSERT INTO dat_y2016m09 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2016-10-01' AND NEW.ts < DATE '2016-11-01' ) THEN
    INSERT INTO dat_y2016m10 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2016-11-01' AND NEW.ts < DATE '2016-12-01' ) THEN
    INSERT INTO dat_y2016m11 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2016-12-01' AND NEW.ts < DATE '2017-01-01' ) THEN
    INSERT INTO dat_y2016m12 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2017-01-01' AND NEW.ts < DATE '2017-02-01' ) THEN
    INSERT INTO dat_y2017m01 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2017-02-01' AND NEW.ts < DATE '2017-03-01' ) THEN
    INSERT INTO dat_y2017m02 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2017-03-01' AND NEW.ts < DATE '2017-04-01' ) THEN
    INSERT INTO dat_y2017m03 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2017-04-01' AND NEW.ts < DATE '2017-05-01' ) THEN
    INSERT INTO dat_y2017m04 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2017-05-01' AND NEW.ts < DATE '2017-06-01' ) THEN
    INSERT INTO dat_y2017m05 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2017-06-01' AND NEW.ts < DATE '2017-07-01' ) THEN
    INSERT INTO dat_y2017m06 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2017-07-01' AND NEW.ts < DATE '2017-08-01' ) THEN
    INSERT INTO dat_y2017m07 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2017-08-01' AND NEW.ts < DATE '2017-09-01' ) THEN
    INSERT INTO dat_y2017m08 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2017-09-01' AND NEW.ts < DATE '2017-10-01' ) THEN
    INSERT INTO dat_y2017m09 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2017-10-01' AND NEW.ts < DATE '2017-11-01' ) THEN
    INSERT INTO dat_y2017m10 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2017-11-01' AND NEW.ts < DATE '2017-12-01' ) THEN
    INSERT INTO dat_y2017m11 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2017-12-01' AND NEW.ts < DATE '2018-01-01' ) THEN
    INSERT INTO dat_y2017m12 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2018-01-01' AND NEW.ts < DATE '2018-02-01' ) THEN
    INSERT INTO dat_y2018m01 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2018-02-01' AND NEW.ts < DATE '2018-03-01' ) THEN
    INSERT INTO dat_y2018m02 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2018-03-01' AND NEW.ts < DATE '2018-04-01' ) THEN
    INSERT INTO dat_y2018m03 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2018-04-01' AND NEW.ts < DATE '2018-05-01' ) THEN
    INSERT INTO dat_y2018m04 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2018-05-01' AND NEW.ts < DATE '2018-06-01' ) THEN
    INSERT INTO dat_y2018m05 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2018-06-01' AND NEW.ts < DATE '2018-07-01' ) THEN
    INSERT INTO dat_y2018m06 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2018-07-01' AND NEW.ts < DATE '2018-08-01' ) THEN
    INSERT INTO dat_y2018m07 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2018-08-01' AND NEW.ts < DATE '2018-09-01' ) THEN
    INSERT INTO dat_y2018m08 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2018-09-01' AND NEW.ts < DATE '2018-10-01' ) THEN
    INSERT INTO dat_y2018m09 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2018-10-01' AND NEW.ts < DATE '2018-11-01' ) THEN
    INSERT INTO dat_y2018m10 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2018-11-01' AND NEW.ts < DATE '2018-12-01' ) THEN
    INSERT INTO dat_y2018m11 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2018-12-01' AND NEW.ts < DATE '2019-01-01' ) THEN
    INSERT INTO dat_y2018m12 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2019-01-01' AND NEW.ts < DATE '2019-02-01' ) THEN
    INSERT INTO dat_y2019m01 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2019-02-01' AND NEW.ts < DATE '2019-03-01' ) THEN
    INSERT INTO dat_y2019m02 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2019-03-01' AND NEW.ts < DATE '2019-04-01' ) THEN
    INSERT INTO dat_y2019m03 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2019-04-01' AND NEW.ts < DATE '2019-05-01' ) THEN
    INSERT INTO dat_y2019m04 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2019-05-01' AND NEW.ts < DATE '2019-06-01' ) THEN
    INSERT INTO dat_y2019m05 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2019-06-01' AND NEW.ts < DATE '2019-07-01' ) THEN
    INSERT INTO dat_y2019m06 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2019-07-01' AND NEW.ts < DATE '2019-08-01' ) THEN
    INSERT INTO dat_y2019m07 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2019-08-01' AND NEW.ts < DATE '2019-09-01' ) THEN
    INSERT INTO dat_y2019m08 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2019-09-01' AND NEW.ts < DATE '2019-10-01' ) THEN
    INSERT INTO dat_y2019m09 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2019-10-01' AND NEW.ts < DATE '2019-11-01' ) THEN
    INSERT INTO dat_y2019m10 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2019-11-01' AND NEW.ts < DATE '2019-12-01' ) THEN
    INSERT INTO dat_y2019m11 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2019-12-01' AND NEW.ts < DATE '2020-01-01' ) THEN
    INSERT INTO dat_y2019m12 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2020-01-01' AND NEW.ts < DATE '2020-02-01' ) THEN
    INSERT INTO dat_y2020m01 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2020-02-01' AND NEW.ts < DATE '2020-03-01' ) THEN
    INSERT INTO dat_y2020m02 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2020-03-01' AND NEW.ts < DATE '2020-04-01' ) THEN
    INSERT INTO dat_y2020m03 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2020-04-01' AND NEW.ts < DATE '2020-05-01' ) THEN
    INSERT INTO dat_y2020m04 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2020-05-01' AND NEW.ts < DATE '2020-06-01' ) THEN
    INSERT INTO dat_y2020m05 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2020-06-01' AND NEW.ts < DATE '2020-07-01' ) THEN
    INSERT INTO dat_y2020m06 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2020-07-01' AND NEW.ts < DATE '2020-08-01' ) THEN
    INSERT INTO dat_y2020m07 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2020-08-01' AND NEW.ts < DATE '2020-09-01' ) THEN
    INSERT INTO dat_y2020m08 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2020-09-01' AND NEW.ts < DATE '2020-10-01' ) THEN
    INSERT INTO dat_y2020m09 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2020-10-01' AND NEW.ts < DATE '2020-11-01' ) THEN
    INSERT INTO dat_y2020m10 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2020-11-01' AND NEW.ts < DATE '2020-12-01' ) THEN
    INSERT INTO dat_y2020m11 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2020-12-01' AND NEW.ts < DATE '2021-01-01' ) THEN
    INSERT INTO dat_y2020m12 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2021-01-01' AND NEW.ts < DATE '2021-02-01' ) THEN
    INSERT INTO dat_y2021m01 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2021-02-01' AND NEW.ts < DATE '2021-03-01' ) THEN
    INSERT INTO dat_y2021m02 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2021-03-01' AND NEW.ts < DATE '2021-04-01' ) THEN
    INSERT INTO dat_y2021m03 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2021-04-01' AND NEW.ts < DATE '2021-05-01' ) THEN
    INSERT INTO dat_y2021m04 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2021-05-01' AND NEW.ts < DATE '2021-06-01' ) THEN
    INSERT INTO dat_y2021m05 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2021-06-01' AND NEW.ts < DATE '2021-07-01' ) THEN
    INSERT INTO dat_y2021m06 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2021-07-01' AND NEW.ts < DATE '2021-08-01' ) THEN
    INSERT INTO dat_y2021m07 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2021-08-01' AND NEW.ts < DATE '2021-09-01' ) THEN
    INSERT INTO dat_y2021m08 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2021-09-01' AND NEW.ts < DATE '2021-10-01' ) THEN
    INSERT INTO dat_y2021m09 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2021-10-01' AND NEW.ts < DATE '2021-11-01' ) THEN
    INSERT INTO dat_y2021m10 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2021-11-01' AND NEW.ts < DATE '2021-12-01' ) THEN
    INSERT INTO dat_y2021m11 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2021-12-01' AND NEW.ts < DATE '2022-01-01' ) THEN
    INSERT INTO dat_y2021m12 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2022-01-01' AND NEW.ts < DATE '2022-02-01' ) THEN
    INSERT INTO dat_y2022m01 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2022-02-01' AND NEW.ts < DATE '2022-03-01' ) THEN
    INSERT INTO dat_y2022m02 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2022-03-01' AND NEW.ts < DATE '2022-04-01' ) THEN
    INSERT INTO dat_y2022m03 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2022-04-01' AND NEW.ts < DATE '2022-05-01' ) THEN
    INSERT INTO dat_y2022m04 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2022-05-01' AND NEW.ts < DATE '2022-06-01' ) THEN
    INSERT INTO dat_y2022m05 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2022-06-01' AND NEW.ts < DATE '2022-07-01' ) THEN
    INSERT INTO dat_y2022m06 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2022-07-01' AND NEW.ts < DATE '2022-08-01' ) THEN
    INSERT INTO dat_y2022m07 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2022-08-01' AND NEW.ts < DATE '2022-09-01' ) THEN
    INSERT INTO dat_y2022m08 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2022-09-01' AND NEW.ts < DATE '2022-10-01' ) THEN
    INSERT INTO dat_y2022m09 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2022-10-01' AND NEW.ts < DATE '2022-11-01' ) THEN
    INSERT INTO dat_y2022m10 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2022-11-01' AND NEW.ts < DATE '2022-12-01' ) THEN
    INSERT INTO dat_y2022m11 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2022-12-01' AND NEW.ts < DATE '2023-01-01' ) THEN
    INSERT INTO dat_y2022m12 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2023-01-01' AND NEW.ts < DATE '2023-02-01' ) THEN
    INSERT INTO dat_y2023m01 VALUES (NEW.*);
  ELSEIF ( NEW.ts >= DATE '2023-02-01' AND NEW.ts < DATE '2023-03-01' ) THEN
    INSERT INTO dat_y2023m02 VALUES (NEW.*);
  ELSE
    RAISE EXCEPTION 'Date out of range.  Something wrong with the dat_insert_trigger() function!';
  END IF;
  RETURN NULL;
END;
$$
LANGUAGE plpgsql;


-- alter ownership
ALTER FUNCTION public.dat_insert_trigger() OWNER TO tt_admin;

-- GRANT usage of function
GRANT EXECUTE ON FUNCTION dat_insert_trigger() TO tt_script;

-- make trigger
CREATE TRIGGER insert_dat_trigger
  BEFORE INSERT ON dat
  FOR EACH ROW EXECUTE PROCEDURE dat_insert_trigger();


-- Make sure 'constraint exclusion' is set to 'partition' in postgresql.conf


